<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            user-select: none;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
        }

        .stage {
            display: none;
        }

        .stage.active {
            display: block;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .icon {
            font-size: 64px;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 24px;
        }

        p {
            color: #666;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .progress {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s ease;
        }

        .warning {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            color: #856404;
            font-size: 14px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .error {
            background: #f8d7da;
            border: 2px solid #dc3545;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            color: #721c24;
            font-size: 14px;
        }

        .info {
            background: #d1ecf1;
            border: 2px solid #17a2b8;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            color: #0c5460;
            font-size: 14px;
        }

        .loading {
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .timer {
            font-size: 48px;
            font-weight: bold;
            color: #667eea;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
        }

        .steps-indicator {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .step {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e0e0e0;
            transition: all 0.3s ease;
        }

        .step.active {
            background: #667eea;
            transform: scale(1.3);
        }

        .step.completed {
            background: #4CAF50;
        }

        .success-checkmark {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
        }

        .check-icon {
            width: 80px;
            height: 80px;
            position: relative;
            border-radius: 50%;
            box-sizing: content-box;
            border: 4px solid #4CAF50;
        }

        .check-icon::before {
            top: 3px;
            left: -2px;
            width: 30px;
            transform-origin: 100% 50%;
            border-radius: 100px 0 0 100px;
        }

        .check-icon::after {
            top: 0;
            left: 30px;
            width: 60px;
            transform-origin: 0 50%;
            border-radius: 0 100px 100px 0;
        }

        .check-icon::before, .check-icon::after {
            content: '';
            height: 100px;
            position: absolute;
            background: white;
            transform: rotate(-45deg);
        }

        .check-icon .icon-line {
            height: 5px;
            background-color: #4CAF50;
            display: block;
            border-radius: 2px;
            position: absolute;
            z-index: 10;
        }

        .check-icon .icon-line.line-tip {
            top: 46px;
            left: 14px;
            width: 25px;
            transform: rotate(45deg);
            animation: icon-line-tip 0.75s;
        }

        .check-icon .icon-line.line-long {
            top: 38px;
            right: 8px;
            width: 47px;
            transform: rotate(-45deg);
            animation: icon-line-long 0.75s;
        }

        @keyframes icon-line-tip {
            0% { width: 0; left: 1px; top: 19px; }
            54% { width: 0; left: 1px; top: 19px; }
            70% { width: 50px; left: -8px; top: 37px; }
            84% { width: 17px; left: 21px; top: 48px; }
            100% { width: 25px; left: 14px; top: 45px; }
        }

        @keyframes icon-line-long {
            0% { width: 0; right: 46px; top: 54px; }
            65% { width: 0; right: 46px; top: 54px; }
            84% { width: 55px; right: 0px; top: 35px; }
            100% { width: 47px; right: 8px; top: 38px; }
        }

        @media (max-width: 480px) {
            .container {
                padding: 20px;
            }
            
            h2 {
                font-size: 20px;
            }

            .timer {
                font-size: 36px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Progress Bar -->
        <div class="progress">
            <div class="progress-bar" id="progressBar" style="width: 0%"></div>
        </div>

        <!-- Steps Indicator -->
        <div class="steps-indicator">
            <div class="step active" id="step1"></div>
            <div class="step" id="step2"></div>
            <div class="step" id="step3"></div>
            <div class="step" id="step4"></div>
        </div>

        <!-- Ù…Ø±Ø­Ù„Ø© Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„Ø£ÙˆÙ„ -->
        <div class="stage active" id="stage1Loading">
            <div class="icon">â³</div>
            <h2>Ø¬Ø§Ø±ÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„Ø£ÙˆÙ„...</h2>
            <div class="timer" id="timer1">15</div>
            <p>ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø­ØªÙ‰ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</p>
            <div class="warning">
                ğŸš« Ù„Ø§ ØªØ¶ØºØ· Ø²Ø± "Ø±Ø¬ÙˆØ¹" ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­<br>
                â±ï¸ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø³ÙŠØ¸Ù‡Ø± Ø£Ø¹Ù„Ø§Ù‡
            </div>
            <div class="info">
                ğŸ“Š Ø§Ù„ØªÙ‚Ø¯Ù…: Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† 1 Ù…Ù† 2
            </div>
        </div>

        <!-- Ù…Ø±Ø­Ù„Ø© Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„Ø«Ø§Ù†ÙŠ -->
        <div class="stage" id="stage2Loading">
            <div class="icon">â³</div>
            <h2>Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„Ø£Ø®ÙŠØ±...</h2>
            <div class="timer" id="timer2">15</div>
            <p>ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹ Ø§Ù†ØªÙ‡ÙŠÙ†Ø§! ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</p>
            <div class="warning">
                ğŸš« Ù„Ø§ ØªØ¶ØºØ· Ø²Ø± "Ø±Ø¬ÙˆØ¹" ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­<br>
                â±ï¸ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø³ÙŠØ¸Ù‡Ø± Ø£Ø¹Ù„Ø§Ù‡
            </div>
            <div class="info">
                ğŸ“Š Ø§Ù„ØªÙ‚Ø¯Ù…: Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† 2 Ù…Ù† 2
            </div>
        </div>

        <!-- Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø®Ø·Ø£ -->
        <div class="stage" id="stageError">
            <div class="icon">âŒ</div>
            <h2>ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</h2>
            <p id="errorMessage">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</p>
            <button class="btn" onclick="retryAd()">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
            <div class="error">
                ğŸ’¡ <strong>ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù†:</strong><br>
                â€¢ Ø¥ÙŠÙ‚Ø§Ù VPN Ø£Ùˆ Proxy<br>
                â€¢ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©<br>
                â€¢ ÙˆØ¬ÙˆØ¯ Ø§ØªØµØ§Ù„ Ø¬ÙŠØ¯ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª<br>
                â€¢ Ø¹Ø¯Ù… Ø§Ø³ØªØ®Ø¯Ø§Ù… AdBlock
            </div>
        </div>

        <!-- Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3: Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø§Ù„Ù‚Ù†Ø§Ø© -->
        <div class="stage" id="stage3">
            <div class="icon">ğŸ“¢</div>
            <h2>Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø£Ø®ÙŠØ±Ø©! ğŸ¯</h2>
            <p>Ø§Ø´ØªØ±Ùƒ ÙÙŠ Ù‚Ù†Ø§ØªÙ†Ø§ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª ÙˆØ§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©</p>
            <button class="btn" onclick="subscribeChannel()">Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø§Ù„Ù‚Ù†Ø§Ø©</button>
            <div class="info">
                âœ¨ Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø³ÙŠØªÙ… ØªÙØ¹ÙŠÙ„ Ø­Ø³Ø§Ø¨Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
            </div>
        </div>

        <!-- Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ -->
        <div class="stage" id="stageSuccess">
            <div class="success-checkmark">
                <div class="check-icon">
                    <span class="icon-line line-tip"></span>
                    <span class="icon-line line-long"></span>
                </div>
            </div>
            <h2>ØªÙ… Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰</h2>
            <p>Ø´ÙƒØ±Ø§Ù‹ Ù„Ø¥ÙƒÙ…Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®Ø·ÙˆØ§Øª<br>Ø¬Ø§Ø±ÙŠ Ù†Ù‚Ù„Ùƒ Ø¥Ù„Ù‰ Ø§Ù„Ø¨ÙˆØª...</p>
        </div>
    </div>

    <!-- Monetag SDK -->
    <script src='//libtl.com/sdk.js' data-zone='10587729' data-sdk='show_10587729'></script>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.disableVerticalSwipes();

        // ===== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨ÙˆØª ÙˆØ§Ù„Ù‚Ù†Ø§Ø© =====
        const BOT_USERNAME = 'WhatIOwnQBot';
        const CHANNEL_USERNAME = 'whatIOwnQB';

        // ===== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª =====
        const AD_CONFIG = {
            1: {
                zoneId: 10587729,
                duration: 15,
                funcName: 'show_10587729'
            },
            2: {
                zoneId: 10587729,
                duration: 15,
                funcName: 'show_10587729'
            }
        };

        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªØ­ÙƒÙ…
        let currentAd = 0;
        let adAttempts = 0;
        const MAX_ATTEMPTS = 3;
        let preventBack = false;
        let adWatchStartTime = 0;
        let focusCheckInterval = null;

        // ===== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±Ø§Ø­Ù„ =====
        function showStage(stageName) {
            document.querySelectorAll('.stage').forEach(s => s.classList.remove('active'));
            const stage = document.getElementById(stageName);
            if (stage) {
                stage.classList.add('active');
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª
            updateStepIndicators(stageName);
            updateProgress(stageName);
        }

        function updateStepIndicators(stageName) {
            const stepMap = {
                'stage1Loading': [1],
                'stage2Loading': [1, 2],
                'stage3': [1, 2, 3],
                'stageSuccess': [1, 2, 3, 4],
                'stageError': []
            };

            const completedSteps = stepMap[stageName] || [];
            const activeStep = completedSteps[completedSteps.length - 1];

            for (let i = 1; i <= 4; i++) {
                const step = document.getElementById(`step${i}`);
                step.classList.remove('active', 'completed');
                
                if (completedSteps.includes(i) && i < activeStep) {
                    step.classList.add('completed');
                } else if (i === activeStep) {
                    step.classList.add('active');
                }
            }
        }

        function updateProgress(stageName) {
            const progressMap = {
                'stage1Loading': 25,
                'stage2Loading': 65,
                'stage3': 80,
                'stageSuccess': 100,
                'stageError': 0
            };
            document.getElementById('progressBar').style.width = (progressMap[stageName] || 0) + '%';
        }

        // ===== Ù…Ù†Ø¹ Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ =====
        function setupBackButtonPrevention() {
            history.pushState({page: 'ad'}, '', '');
            
            window.addEventListener('popstate', function(event) {
                if (preventBack) {
                    history.pushState({page: 'ad'}, '', '');
                    tg.showAlert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø£ÙˆÙ„Ø§Ù‹');
                }
            });
        }

        setupBackButtonPrevention();

        // Ù…Ù†Ø¹ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('beforeunload', function(e) {
            if (preventBack) {
                e.preventDefault();
                e.returnValue = '';
                return 'âš ï¸ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ù„Ù… ÙŠÙ†ØªÙ‡ÙŠ Ø¨Ø¹Ø¯. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ';
            }
        });

        // ===== Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ù…Ø¹ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ØµØ§Ø±Ù… =====
        function showAd(adNumber) {
            if (adAttempts >= MAX_ATTEMPTS) {
                document.getElementById('errorMessage').textContent = 
                    'Ø¹Ø°Ø±Ø§Ù‹ØŒ ØªØ¬Ø§ÙˆØ²Øª Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ø¨Ù‡Ø§. ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©.';
                showStage('stageError');
                return;
            }

            currentAd = adNumber;
            adAttempts++;
            
            const config = AD_CONFIG[adNumber];
            
            // Ø¹Ø±Ø¶ Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
            showStage(`stage${adNumber}Loading`);
            preventBack = true;
            adWatchStartTime = Date.now();

            try {
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ù„Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†
                const adFunction = window[config.funcName];
                
                if (typeof adFunction !== 'function') {
                    throw new Error('Ad script not loaded');
                }

                // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†
                const adResult = adFunction();
                
                // âœ… Ø¥Ø°Ø§ ÙƒØ§Ù† ÙŠØ±Ø¬Ø¹ Promise
                if (adResult && typeof adResult.then === 'function') {
                    adResult
                        .then(() => {
                            onAdSuccess(adNumber);
                        })
                        .catch((error) => {
                            // ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ØŒ Ù†Ø³ØªØ®Ø¯Ù… Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ + Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Focus
                            console.warn('âš ï¸ Promise failed, using timer fallback');
                            startAdTimer(adNumber, config.duration);
                        });
                } 
                // âœ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ + Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Focus
                else {
                    startAdTimer(adNumber, config.duration);
                }
                
            } catch (error) {
                handleAdError(error);
            }
        }

        // ===== Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ Ø§Ù„Ù…Ø­Ø³Ù‘Ù† Ù…Ø¹ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Focus =====
        function startAdTimer(adNumber, duration) {
            let timeLeft = duration;
            const timerElement = document.getElementById(`timer${adNumber}`);
            let adWindowOpened = false;
            let userReturnedAt = null;

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø£ÙˆÙ„ÙŠ Ù…Ù† ÙØªØ­ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† (Ø¨Ø¹Ø¯ 2 Ø«Ø§Ù†ÙŠØ©)
            setTimeout(() => {
                if (!document.hasFocus()) {
                    adWindowOpened = true;
                    console.log('âœ… Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† ÙÙØªØ­Øª');
                }
            }, 2000);

            // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø±Ø¬ÙˆØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            const focusHandler = () => {
                if (adWindowOpened && !userReturnedAt) {
                    userReturnedAt = Date.now();
                    const watchTime = Math.floor((userReturnedAt - adWatchStartTime) / 1000);
                    console.log(`ğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø±Ø¬Ø¹ Ø¨Ø¹Ø¯ ${watchTime} Ø«Ø§Ù†ÙŠØ©`);
                }
            };

            window.addEventListener('focus', focusHandler);

            // Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ
            const countdown = setInterval(() => {
                timerElement.textContent = timeLeft;
                timeLeft--;
                
                if (timeLeft < 0) {
                    clearInterval(countdown);
                    window.removeEventListener('focus', focusHandler);
                    
                    // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø°ÙƒÙŠ
                    const totalTime = Math.floor((Date.now() - adWatchStartTime) / 1000);
                    
                    if (adWindowOpened || totalTime >= duration - 2) {
                        // Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† ØªÙ… Ù…Ø´Ø§Ù‡Ø¯ØªÙ‡ (Ø¥Ù…Ø§ ÙÙØªØ­Øª Ø§Ù„Ù†Ø§ÙØ°Ø© Ø£Ùˆ Ù…Ø± Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙƒØ§ÙÙŠ)
                        onAdSuccess(adNumber);
                    } else {
                        // Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ù„Ù… ÙŠÙØ´Ø§Ù‡Ø¯ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
                        handleAdError(new Error('Ad not properly viewed'));
                    }
                }
            }, 1000);
        }

        // ===== Ù†Ø¬Ø§Ø­ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† =====
        function onAdSuccess(adNumber) {
            preventBack = false;
            adAttempts = 0; // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ù†Ø¬Ø§Ø­
            
            console.log(`âœ… Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† ${adNumber} Ø§ÙƒØªÙ…Ù„ Ø¨Ù†Ø¬Ø§Ø­`);
            
            // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©
            if (adNumber === 1) {
                setTimeout(() => showAd(2), 1000); // Ø¨Ø¯Ø¡ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„Ø«Ø§Ù†ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
            } else if (adNumber === 2) {
                setTimeout(() => showStage('stage3'), 1000);
            }
        }

        // ===== Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ =====
        function handleAdError(error) {
            console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†:', error);
            preventBack = false;
            
            const errorMessages = {
                'Ad script not loaded': 'âš ï¸ Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª.\nÙŠØ±Ø¬Ù‰ Ø¥ÙŠÙ‚Ø§Ù AdBlock ÙˆØ¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©.',
                'Ad not properly viewed': 'âš ï¸ Ù„Ù… ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­.\nÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø­ØªÙ‰ ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†.',
                'Ad window not opened': 'âš ï¸ Ù„Ù… ÙŠØªÙ… ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†.\nØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©.',
                'default': 'âš ï¸ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†.\nÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.'
            };
            
            document.getElementById('errorMessage').textContent = 
                errorMessages[error.message] || errorMessages['default'];
            
            showStage('stageError');
        }

        // ===== Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© =====
        function retryAd() {
            adAttempts = Math.max(0, adAttempts - 1); // ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ù„Ø¥Ø¹Ø·Ø§Ø¡ ÙØ±ØµØ© Ø£Ø®Ø±Ù‰
            showAd(currentAd || 1);
        }

        // ===== Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø§Ù„Ù‚Ù†Ø§Ø© =====
        function subscribeChannel() {
            // ÙØªØ­ Ø§Ù„Ù‚Ù†Ø§Ø©
            window.open(`https://t.me/${CHANNEL_USERNAME}`, '_blank');
            
            // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
            setTimeout(() => {
                showStage('stageSuccess');
                
                // Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¨ÙˆØª
                setTimeout(() => {
                    try {
                        tg.sendData(JSON.stringify({
                            action: 'verification_complete',
                            timestamp: Date.now()
                        }));
                    } catch (e) {
                        console.log('Telegram WebApp API not available');
                    }
                    
                    // ÙØªØ­ Ø§Ù„Ø¨ÙˆØª
                    window.open(`https://t.me/${BOT_USERNAME}?start=s`, '_self');
                }, 2000);
            }, 1000);
        }

        // ===== ØªØ­Ù…ÙŠÙ„ Ø³ÙƒØ±ÙŠØ¨ØªØ§Øª Monetag =====
        function loadMonetag(zoneId) {
            const script = document.createElement('script');
            script.src = `https://cledegst.net/401/${zoneId}`;
            script.async = true;
            script.onerror = function() {
                console.error(`âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø³ÙƒØ±ÙŠØ¨Øª Monetag: ${zoneId}`);
            };
            script.onload = function() {
                console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø³ÙƒØ±ÙŠØ¨Øª Monetag: ${zoneId}`);
            };
            
            try {
                document.body.appendChild(script);
            } catch (e) {
                console.error('âŒ ÙØ´Ù„ Ø¥Ø¶Ø§ÙØ© Ø³ÙƒØ±ÙŠØ¨Øª Monetag:', e);
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„Ø£ÙˆÙ„
        loadMonetag(AD_CONFIG[1].zoneId);

        // ØªØ­Ù…ÙŠÙ„ Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„Ø«Ø§Ù†ÙŠ (Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø®ØªÙ„Ù)
        if (AD_CONFIG[2].zoneId !== AD_CONFIG[1].zoneId) {
            loadMonetag(AD_CONFIG[2].zoneId);
        }

        // ===== Anti-AdBlock Detection =====
        (function() {
            const testAd = document.createElement('div');
            testAd.className = 'ad ads adsbox ad-placement ad-placeholder';
            testAd.style.position = 'absolute';
            testAd.style.top = '-1px';
            testAd.style.height = '1px';
            document.body.appendChild(testAd);

            setTimeout(() => {
                if (testAd.offsetHeight === 0) {
                    console.warn('âš ï¸ AdBlock Ù…ÙØ¹Ù‘Ù„');
                    
                    const warningDiv = document.createElement('div');
                    warningDiv.style.cssText = `
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        background: #ff4444;
                        color: white;
                        padding: 10px;
                        text-align: center;
                        z-index: 9999;
                        font-weight: bold;
                    `;
                    warningDiv.textContent = 'âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥ÙŠÙ‚Ø§Ù AdBlock Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª ÙˆØ§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ';
                    document.body.appendChild(warningDiv);
                }
                document.body.removeChild(testAd);
            }, 100);
        })();

        // ===== Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ =====
        window.addEventListener('load', function() {
            console.log('ğŸš€ ØªØ­Ù…ÙŠÙ„ ØµÙØ­Ø© Ø§Ù„ØªØ­Ù‚Ù‚');
            
            // Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø³ÙƒØ±ÙŠØ¨ØªØ§Øª Monetag Ø«Ù… Ø¨Ø¯Ø¡ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„Ø£ÙˆÙ„
            setTimeout(() => {
                showAd(1);
            }, 1500);
        });
    </script>

</body>
</html>
